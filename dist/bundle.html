<!DOCTYPE html>
<div id="macro-calculator"></div>

<!-- React Dependencies -->
<script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
<!-- PDF Generation -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<!-- Styles -->
<style>
#macro-calculator {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
    font-family: 'Helvetica Neue', Arial, sans-serif;
    color: #2c3e50;
    background: #f8f9fa;
}

.calculator-card {
    background: white;
    padding: 30px;
    border-radius: 10px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.form-group {
    margin-bottom: 12px;
    position: relative;
}

.gender-group {
    display: flex;
    gap: 20px;
    margin: 10px 0;
    justify-content: flex-start;
    align-items: flex-start;
    max-width: 50%;
}

.gender-button {
    flex: 1;
    padding: 12px 24px;
    border: 2px solid #2c3e50;
    border-radius: 4px;
    font-size: 16px;
    cursor: pointer;
    transition: all 0.3s ease;
    background: white;
    color: #2c3e50;
    text-align: center;
    margin: 5px 0;
}

.gender-button:hover {
    background: #94a3b8;
    color: white;
}

.gender-button.selected {
    background: #2c3e50;
    color: white;
}

.measurements-group {
    display: flex;
    gap: 50px;
    margin: 10px 0;
    align-items: flex-start;
    justify-content: flex-start;
}

.number-input-group {
    max-width: 120px;
    width: 100%;
}

.input-field {
    padding: 8px 12px;
    font-size: 14px;
    width: 100%;
    max-width: 100%;
    margin: 4px 0;
    border: 1px solid #cbd5e0;
    border-radius: 4px;
    box-sizing: border-box;
}

.input-field[type="number"] {
    -moz-appearance: textfield;
    -webkit-appearance: textfield;
    appearance: textfield;
}

.input-field[type="number"]::-webkit-outer-spin-button,
.input-field[type="number"]::-webkit-inner-spin-button {
    -webkit-appearance: none;
    appearance: none;
    margin: 0;
}

.activity-group {
    flex: 0 0 60%;
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin: 10px 0;
}

.activity-button {
    padding: 8px 16px;
    font-size: 14px;
}

.activity-button:hover {
    background: #94a3b8;
    color: white;
}

.activity-button.selected {
    background: #2c3e50;
    color: white;
}

.button {
    background: #2c3e50;
    color: white;
    padding: 12px 24px;
    border: none;
    border-radius: 4px;
    font-size: 16px;
    width: 100%;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.button:hover {
    background: #34495e;
}

.results {
    display: grid;
    grid-template-columns: 45% 55%;
    gap: 20px;
    margin-top: 20px;
    padding: 15px;
}

.results-section {
    background: #f8fafc;
    padding: 15px;
    border-radius: 4px;
}

.macro-result {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 6px 8px;
}

.macro-result span:first-child {
    display: flex;
    align-items: center;
}

label {
    color: #4a5568;
    font-weight: 500;
    display: block;
    margin-bottom: 5px;
}

/* Mobile responsive adjustments */
@media (max-width: 768px) {
    #macro-calculator {
        max-width: 100%;
        padding: 10px;
    }
    
    .calculator-card {
        padding: 15px;
    }
    .results {
        grid-template-columns: 1fr;  /* Stack on mobile */
        gap: 15px;
    }
}

.customize-row {
    display: flex;
    gap: 50px;
    align-items: flex-start;
}

.warning-text {
    color: #e53e3e;
    font-size: 14px;
    margin-top: 4px;
}

.input-field.warning {
    border-color: #e53e3e;
}

.activity-description-box {
    flex: 1;
    min-height: 150px;
    max-height: 150px;
}

.slider-container {
    padding-top: 10px;
}

.slider-value {
    text-align: center;
    font-weight: bold;
    margin: 10px 0;
}

.slider {
    width: 100%;
    height: 8px;
    -webkit-appearance: none;
    background: linear-gradient(to right,
        #e53e3e 0%, #e53e3e 15%,
        #ecc94b 15%, #ecc94b 35%,
        #2f855a 35%, #2f855a 65%,
        #ecc94b 65%, #ecc94b 85%,
        #e53e3e 85%, #e53e3e 100%
    );
    border-radius: 4px;
    outline: none;
}

.slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 20px;
    height: 20px;
    background: white;
    border: 2px solid #2c3e50;
    border-radius: 50%;
    cursor: pointer;
}

.slider::-moz-range-thumb {
    width: 20px;
    height: 20px;
    background: white;
    border: 2px solid #2c3e50;
    border-radius: 50%;
    cursor: pointer;
}

.slider-labels {
    display: flex;
    justify-content: space-between;
    margin-top: 5px;
    color: #666;
    font-size: 14px;
}

.navy-measurements {
    display: flex;
    gap: 15px;
    align-items: flex-start;
    margin-top: 10px;
    width: 95%;  /* Match parent width */
}

.measurement-input {
    flex: 1;
    margin: 0;
}

.measurement-input .input-field {
    width: 100%;  /* Take full width of parent */
}

.measurement-tooltip {
    position: relative;
    display: inline-block;
    margin-left: 4px;
    color: #718096;
    cursor: help;
}

.measurement-tooltip::after {
    content: "â“˜";
    font-size: 12px;
}

.measurement-tooltip:hover::before {
    content: attr(data-tip);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    padding: 4px 8px;
    background: #2c3e50;
    color: white;
    border-radius: 4px;
    font-size: 12px;
    white-space: nowrap;
    z-index: 10;
    margin-bottom: 5px;
}

.estimated-bf {
    margin-top: 10px;
    padding: 10px;
    background: #f7fafc;
    border-radius: 4px;
    text-align: center;
    font-weight: bold;
}

.measurement-instruction {
    font-size: 12px;
    color: #666;
    margin-top: 4px;
    font-style: italic;
    line-height: 1.4;
}

.body-comp-content {
    max-width: 100%;
    overflow: hidden;
}

.customize-button {
    background: none;
    border: 1px solid #2c3e50;
    color: #2c3e50;
    padding: 4px 12px;
    border-radius: 4px;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.customize-button:hover {
    background: #2c3e50;
    color: white;
}

.customize-section {
    padding: 12px;
    margin-bottom: 12px;
}

.customize-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-bottom: 12px;
}

.macro-customize {
    flex: 1;
    max-width: 200px;
}

.macro-results {
    border-top: 1px solid #e2e8f0;
    padding-top: 15px;
}

.gender-toggle {
    position: relative;
    width: 200px;
    height: 44px;
    background: #f8fafc;
    border: 2px solid #2c3e50;
    border-radius: 8px;
    cursor: pointer;
    overflow: hidden;
    transition: all 0.3s ease;
    margin-top: 8px;
}

.gender-toggle-slider {
    position: absolute;
    top: 2px;  /* Add 2px padding */
    left: 2px;  /* Add 2px padding */
    width: calc(50% - 4px);  /* Account for padding */
    height: calc(100% - 4px);  /* Account for padding */
    background: #2c3e50;
    border-radius: 6px;
    transition: transform 0.3s ease;
}

.gender-toggle.female .gender-toggle-slider {
    transform: translateX(calc(100% + 4px));  /* Account for padding */
}

.gender-toggle-labels {
    position: relative;
    display: flex;
    height: 100%;
    z-index: 1;
}

.gender-toggle-label {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    font-weight: 500;
    transition: all 0.3s ease;
    padding: 0 10px;
}

.gender-toggle-label.active {
    color: white;
    font-weight: 600;
}

.gender-toggle-label:not(.active) {
    color: #2c3e50;
}

.gender-toggle:hover {
    border-color: #34495e;
    background: #ffffff;
}

.gender-toggle:hover .gender-toggle-label:not(.active) {
    color: #34495e;
}

.segmented-control {
    position: relative;
    display: inline-flex;
    background: #e2e8f0;
    border-radius: 8px;
    padding: 2px;
    gap: 2px;
    margin-top: 8px;
}

.segmented-control input[type="radio"] {
    display: none;
}

.segmented-control label {
    position: relative;
    flex: 1;
    text-align: center;
    padding: 8px 24px;
    cursor: pointer;
    transition: all 0.3s ease;
    border-radius: 6px;
    font-weight: 500;
    color: #64748b;
    min-width: 80px;
}

.segmented-control input[type="radio"]:checked + label {
    background: white;
    color: #2c3e50;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

/* Update measurements group for better alignment */
.basic-info-row {
    display: flex;
    align-items: flex-start;
    gap: 20px;
    margin-top: 15px;
}

.basic-info-row .number-input-group {
    flex: 1;
}

/* Update accordion styles */
.accordion-content {
    padding: 15px;
}

.accordion-header {
    padding: 10px 15px;
}

/* Update input fields */
.input-field {
    padding: 8px 12px;
    font-size: 14px;
    width: 100%;
    max-width: 100%;
    margin: 4px 0;
    border: 1px solid #cbd5e0;
    border-radius: 4px;
    box-sizing: border-box;
}

/* Update activity buttons */
.activity-button {
    padding: 8px 16px;
    font-size: 14px;
}

/* Update results layout */
.results {
    display: grid;
    grid-template-columns: 45% 55%;
    gap: 20px;
    margin-top: 20px;
    padding: 15px;
}

.results-section {
    background: #f8fafc;
    padding: 15px;
    border-radius: 4px;
}

.macro-result {
    padding: 4px 8px;
    font-size: 13px;
}

/* Update customization section */
.customize-section {
    padding: 12px;
    margin-bottom: 12px;
}

.customize-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-bottom: 12px;
}

.slider-container {
    padding-top: 10px;
}

/* Make accordion sections more compact */
.accordion-section {
    margin-bottom: 8px;
}

.accordion-header {
    padding: 10px 15px;
}

.accordion-content {
    padding: 15px;
}

.info-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 16px;
    height: 16px;
    border: 1px solid #718096;
    border-radius: 50%;
    font-size: 12px;
    color: #718096;
    margin-left: 4px;
    cursor: help;
}

.energy-label {
    display: flex;
    align-items: center;
}

.info-label {
    display: inline-flex;
    align-items: center;
    color: #4a5568;
    position: relative;
    cursor: help;
}

.info-label::after {
    content: "â“˜";  /* Info symbol */
    font-size: 12px;
    margin-left: 4px;
    color: #718096;
    opacity: 0.7;
}

.info-label:hover::before {
    content: attr(title);
    position: absolute;
    left: 0;
    top: -30px;
    background: #2c3e50;
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    white-space: nowrap;
    z-index: 10;
}

/* Add a small arrow to the tooltip */
.info-label:hover::after {
    content: "";
    position: absolute;
    left: 10px;
    top: -8px;
    border-width: 4px;
    border-style: solid;
    border-color: #2c3e50 transparent transparent transparent;
}

.help-icon {
    color: #718096;
    font-size: 14px;
    margin-left: 4px;
    opacity: 0.6;
}

.tooltip {
    position: relative;
    display: inline-block;
}

.tooltip:hover::after {
    content: attr(data-tooltip);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    padding: 4px 8px;
    background: #2c3e50;
    color: white;
    border-radius: 4px;
    font-size: 12px;
    white-space: nowrap;
    z-index: 10;
}

.target-divider {
    border-top: 2px solid #e2e8f0;
    margin: 8px 0;
}

.edit-icon {
    background: none;
    border: 1px solid #2c3e50;
    color: #2c3e50;
    width: 28px;
    height: 28px;
    border-radius: 4px;
    font-size: 16px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    padding: 0;
}

.edit-icon:hover {
    background: #2c3e50;
    color: white;
    border-color: #2c3e50;
}

/* When in edit mode (showing checkmark) */
.edit-icon.active {
    background: #2c3e50;
    color: white;
    border-color: #2c3e50;
}

.customize-panel {
    margin-top: 10px;
    padding: 12px;
    background: #f8fafc;
    border-radius: 4px;
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    padding: 8px 0;
}

.toggle-customize {
    font-size: 13px;
    color: #718096;
}

.macro-label {
    display: flex;
    align-items: center;
}

.macro-value {
    display: flex;
    align-items: center;
    gap: 4px;
}

.inline-edit {
    width: 60px;
    padding: 2px 6px;
    margin: 0 4px;
    font-size: 13px;
    border: 1px solid #cbd5e0;
    border-radius: 4px;
}

.macro-label-with-ratio {
    color: #4a5568;
    font-size: 13px;
}

.floating-label {
    position: absolute;
    left: 10px;
    top: 50%;
    transform: translateY(-50%);
    transition: all 0.2s;
    pointer-events: none;
    color: #718096;
}

.input-field:focus + .floating-label,
.input-field:not(:placeholder-shown) + .floating-label {
    top: 0;
    transform: translateY(-100%) scale(0.85);
    background: white;
    padding: 0 4px;
}

.gender-select {
    display: flex;
    gap: 10px;
    margin-top: 8px;
}

.gender-option {
    flex: 1;
    padding: 8px 16px;
    background: white;
    border: 1px solid #cbd5e0;
    border-radius: 4px;
    cursor: pointer;
    color: #4a5568;
    font-size: 14px;
    transition: all 0.2s ease;
    text-align: center;
}

.gender-option.selected {
    background: #2c3e50;
    color: white;
    border-color: #2c3e50;
}

.gender-option:hover:not(.selected) {
    border-color: #2c3e50;
    background: #f8fafc;
}

/* Update body composition styles */
.body-comp-inputs {
    width: 95%;  /* Use percentage instead of calc */
    box-sizing: border-box;
}

.body-comp-inputs .form-group {
    margin-bottom: 15px;
}

.body-comp-inputs .input-field {
    width: 95%;  /* Match parent width */
    box-sizing: border-box;
}

/* Update navy measurements */
.navy-measurements {
    display: flex;
    gap: 15px;
    align-items: flex-start;
    margin-top: 10px;
    width: 95%;  /* Match parent width */
}

.measurement-input {
    flex: 1;
    margin: 0;
}

.measurement-input .input-field {
    width: 100%;  /* Take full width of parent */
}

/* Add styles for methodology section */
.methodology-section {
    margin-top: 20px;
    padding: 20px;
    background: #f8fafc;
    border-radius: 4px;
}

.methodology-section h4 {
    color: #2c3e50;
    margin: 0 0 15px 0;
    display: flex;
    align-items: center;
    cursor: pointer;
}

.methodology-content {
    font-size: 14px;
    color: #4a5568;
    line-height: 1.6;
}

.methodology-subsection {
    margin-bottom: 15px;
}

.methodology-subsection h5 {
    color: #2c3e50;
    margin: 10px 0 5px 0;
    font-size: 15px;
}

.formula {
    font-family: monospace;
    background: #edf2f7;
    padding: 8px 12px;
    border-radius: 4px;
    margin: 5px 0;
}

/* Add styles for the summary section */
.summary-section {
    margin-top: 20px;
    padding: 20px;
    background: white;
    border-radius: 4px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.summary-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.summary-content {
    font-size: 14px;
    line-height: 1.6;
}

.summary-stats {
    background: #f8fafc;
    padding: 15px;
    border-radius: 4px;
    margin: 15px 0;
}

.transform-services {
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid #e2e8f0;
}

.print-button {
    background: #2c3e50;
    color: white;
    padding: 8px 16px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
}

.print-button:hover {
    background: #34495e;
}

/* Print styles */
@media print {
    /* Hide Squarespace elements */
    header,
    .header,
    .header-nav-wrapper,
    .header-nav,
    .site-navigation,
    .Header,
    .Header-nav,
    .Header-nav-inner,
    .Header-nav-list,
    .Navigation,
    .Footer,
    .footer,
    .site-footer,
    #header,
    #footer,
    #siteNav,
    .sqs-announcement-bar,
    .mobile-nav-toggle,
    .mobile-nav,
    #topNav {
        display: none !important;
    }

    /* Force body/content to full width */
    body,
    .Site,
    .Main,
    .Content-outer,
    .sqs-layout {
        margin: 0 !important;
        padding: 0 !important;
        width: 100% !important;
        max-width: none !important;
    }

    /* Ensure our calculator takes up the full page */
    #macro-calculator {
        margin: 0 !important;
        padding: 0 !important;
        width: 100% !important;
        max-width: none !important;
        background: white !important;
    }

    /* Optimize summary section for printing */
    .summary-section {
        page-break-inside: avoid;
        margin: 0;
        padding: 20px;
        width: 100%;
        box-sizing: border-box;
    }

    /* Hide calculator interface */
    .calculator-card > form,
    .results,
    .methodology-section {
        display: none !important;
    }
}

/* Add styles for email form */
.email-form {
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid #e2e8f0;
}

.email-input-group {
    display: flex;
    gap: 10px;
    margin-top: 10px;
}

.email-input {
    flex: 1;
    padding: 8px 12px;
    border: 1px solid #cbd5e0;
    border-radius: 4px;
    font-size: 14px;
}

.email-button {
    background: #2c3e50;
    color: white;
    padding: 8px 16px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    white-space: nowrap;
}

.email-button:hover {
    background: #34495e;
}

.email-status {
    margin-top: 10px;
    font-size: 14px;
}

.email-status.success {
    color: #2f855a;
}

.email-status.error {
    color: #e53e3e;
}
</style>

<!-- React Component -->
<script type="text/babel">
// Main Calculator Component
const Calculator = () => {
    // State Management
    const [data, setData] = React.useState({
        gender: '',
        weight: '',
        height: '',
        bodyFat: '',
        activity: '',
        goal: '',
        bodyFatMethod: 'dexa'
    });
    const [results, setResults] = React.useState(null);
    const [showCustomize, setShowCustomize] = React.useState(false);
    const [customCarbs, setCustomCarbs] = React.useState('120');
    const [proteinMultiplier, setProteinMultiplier] = React.useState('1.0');
    const [leanMass, setLeanMass] = React.useState(0);
    const [calorieAdjustment, setCalorieAdjustment] = React.useState(0);
    const [hoverDescription, setHoverDescription] = React.useState(`
        Hover over an activity level to see its description.
        
        Each activity level has a different calorie multiplier that affects your total daily energy expenditure.
    `);
    const [openSections, setOpenSections] = React.useState({
        profile: true,
        activity: false
    });
    const [isCalculating, setIsCalculating] = React.useState(false);
    const [validationErrors, setValidationErrors] = React.useState({});
    const [showMethodology, setShowMethodology] = React.useState(false);
    const [email, setEmail] = React.useState('');
    const [emailStatus, setEmailStatus] = React.useState('');
    const [isSubmitting, setIsSubmitting] = React.useState(false);

    // Add measurement instructions
    const measurementInstructions = {
        male: {
            waist: "Measure around your abdomen at the level of your belly button (navel), keeping the tape parallel to the floor.",
            neck: "Measure around your neck at the point just below the larynx (Adam's apple), keeping the tape perpendicular to the long axis of your neck."
        },
        female: {
            waist: "Measure your natural waist at the narrowest point between your lower rib and the top of your hip bone, keeping the tape parallel to the floor.",
            neck: "Measure around your neck at the point just below the larynx, keeping the tape perpendicular to the long axis of your neck.",
            hip: "Measure around the widest part of your hips/buttocks, keeping the tape parallel to the floor."
        }
    };

    // Add accordion styles
    const accordionStyles = {
        section: {
            border: '1px solid #e2e8f0',
            borderRadius: '4px',
            marginBottom: '8px'
        },
        header: {
            padding: '10px 15px',
            background: '#f8fafc',
            cursor: 'pointer',
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center'
        },
        content: {
            padding: '15px',
            borderTop: '1px solid #e2e8f0'
        },
        title: {
            margin: 0,
            fontSize: '15px',
            fontWeight: '500'
        }
    };

    // Calculate function - handles all the macro calculations
    const calculate = async (e) => {
        e.preventDefault();
        setIsCalculating(true);
        // Add small delay to show loading state
        await new Promise(resolve => setTimeout(resolve, 500));
        // Collapse all sections
        setOpenSections({
            profile: false,
            activity: false
        });
        const weight = parseFloat(data.weight);
        const height = parseFloat(data.height);
        const bodyFat = parseFloat(data.bodyFat);
        
        const calculatedLeanMass = weight * (1 - (bodyFat / 100));
        setLeanMass(calculatedLeanMass);
        
        let bmr = (data.gender === 'male')
            ? (10 * weight * 0.453592) + (6.25 * height * 2.54) - (5 * 25) + 5
            : (10 * weight * 0.453592) + (6.25 * height * 2.54) - (5 * 25) - 161;
        
        const multipliers = {
            sedentary: 1.2,
            light: 1.375,
            moderate: 1.55,
            very: 1.725
        };
        
        const tdee = bmr * multipliers[data.activity];
        const activityCalories = tdee - bmr;
        
        let targetCalories = tdee;
        
        if (data.goal === 'lose') {
            targetCalories *= 0.8;
            setCalorieAdjustment(-20);
        } else if (data.goal === 'gain') {
            targetCalories *= 1.2;
            setCalorieAdjustment(20);
        } else if (data.goal === 'maintain') {
            setCalorieAdjustment(0);
        }

        const energyData = {
            bmr: Math.round(bmr),
            activityCalories: Math.round(activityCalories),
            tdee: Math.round(tdee),
            calorieAdjustment: data.goal === 'lose' ? -20 : 
                              data.goal === 'gain' ? 20 : 0
        };

        console.log('Calculate function - BMR:', bmr);
        console.log('Calculate function - Activity Calories:', activityCalories);
        console.log('Calculate function - TDEE:', tdee);
        console.log('Calculate function - Energy Data:', energyData);
        updateMacros(targetCalories, calculatedLeanMass, energyData);
        setIsCalculating(false);
    };
    // Updates macro calculations based on user customizations
    const updateMacros = (calories, currentLeanMass = leanMass, energyData = null) => {
        const adjustedCalories = calories * (1 + (calorieAdjustment / 100));
        
        const protein = Math.round(currentLeanMass * parseFloat(proteinMultiplier));
        const carbs = parseInt(customCarbs);
        const fat = Math.max(0, Math.round((adjustedCalories - (protein * 4) - (carbs * 4)) / 9);

        const newResults = {
            calories: Math.round(adjustedCalories),
            protein,
            carbs,
            fat,
            energyData: energyData || (results && results.energyData ? {...results.energyData} : {
                bmr: 0,
                activityCalories: 0,
                tdee: 0,
                calorieAdjustment: calorieAdjustment
            })
        };
        
        setResults(newResults);
    };

    // Effect hook for updating macros when customizations change
    React.useEffect(() => {
        if (results && results.energyData && results.energyData.tdee) {
            const currentEnergyData = {
                bmr: results.energyData.bmr,
                activityCalories: results.energyData.activityCalories,
                tdee: results.energyData.tdee,
                calorieAdjustment: calorieAdjustment
            };
            
            const baseCalories = results.energyData.tdee;  // Use TDEE as base
            const adjustedCalories = baseCalories * (1 + (calorieAdjustment / 100));
            
            const protein = Math.round(leanMass * parseFloat(proteinMultiplier));
            const carbs = parseInt(customCarbs);
            const fat = Math.max(0, Math.round((adjustedCalories - (protein * 4) - (carbs * 4)) / 9));

            setResults({
                calories: Math.round(adjustedCalories),
                protein,
                carbs,
                fat,
                energyData: currentEnergyData
            });
        }
    }, [customCarbs, proteinMultiplier, calorieAdjustment]);

    // Add this before the Calculator component
    const calculateNavyBodyFat = (data) => {
        if (!data.gender || !data.height) {
            return '';
        }

        if (!data.waist || !data.neck || (data.gender === 'female' && !data.hip)) {
            return '';
        }

        const waist = parseFloat(data.waist);
        const neck = parseFloat(data.neck);
        const height = parseFloat(data.height);
        
        // Validate measurements
        if (isNaN(waist) || isNaN(neck) || isNaN(height)) {
            return '';
        }
        
        if (waist < 20 || waist > 80) return ''; // Unrealistic waist
        if (neck < 10 || neck > 30) return '';   // Unrealistic neck
        
        if (data.gender === 'male') {
            if (waist <= neck) {
                return ''; // Waist must be larger than neck
            }
            // Male Formula: %bf = 86.010Ã—log10(waist-neck) - 70.041Ã—log10(height) + 36.76
            const bodyFat = 86.010 * Math.log10(waist - neck) - 70.041 * Math.log10(height) + 36.76;
            return Math.max(Math.round(bodyFat * 10) / 10, 2); // Minimum 2% body fat
        } else {
            const hip = parseFloat(data.hip);
            if (isNaN(hip)) {
                return '';
            }
            if (hip < 25 || hip > 80) return ''; // Unrealistic hip
            
            // Female Formula: %bf = 163.205Ã—log10(waist+hip-neck) - 97.684Ã—log10(height) - 78.387
            const bodyFat = 163.205 * Math.log10(waist + hip - neck) - 97.684 * Math.log10(height) - 78.387;
            return Math.max(Math.round(bodyFat * 10) / 10, 10); // Minimum 10% body fat
        }
    };

    // Add this function inside the Calculator component
    const isFormValid = () => {
        return (
            data.gender && 
            data.weight && 
            data.height && 
            data.activity && 
            data.goal &&
            (data.bodyFat || 
                (data.bodyFatMethod === 'navy' && 
                 data.waist && 
                 data.neck && 
                 (data.gender === 'male' || data.hip)
                )
            )
        );
    };

    // Add validation function
    const validateField = (name, value) => {
        switch(name) {
            case 'weight':
                return value > 0 && value < 1000 ? '' : 'Please enter a valid weight';
            case 'height':
                return value > 0 && value < 120 ? '' : 'Please enter a valid height';
            // ... other validations
        }
    };

    // Add this function inside the Calculator component
    const generatePDF = () => {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        // Set font styles
        doc.setFont('helvetica');
        
        // Add Transform Training logo/header
        doc.setFontSize(24);
        doc.setTextColor(44, 62, 80); // #2c3e50
        doc.text('Transform Training', 20, 20);
        
        // Add title
        doc.setFontSize(18);
        doc.text('Personalized Nutrition Plan', 20, 35);
        
        // Add client profile
        doc.setFontSize(12);
        doc.setTextColor(74, 85, 104); // #4a5568
        doc.text('Client Profile:', 20, 50);
        doc.text(`Height: ${data.height} inches`, 30, 60);
        doc.text(`Weight: ${data.weight} lbs`, 30, 67);
        doc.text(`Body Fat: ${data.bodyFat}%`, 30, 74);
        doc.text(`Lean Body Mass: ${Math.round(leanMass)} lbs`, 30, 81);
        doc.text(`Activity Level: ${data.activity}`, 30, 88);
        doc.text(`Goal: ${data.goal === 'lose' ? 'Lose Body Fat' :
                         data.goal === 'maintain' ? 'Maintain Body Composition' :
                         data.goal === 'gain' ? 'Build Lean Muscle' : ''}`, 30, 95);

        // Add daily targets
        doc.setFontSize(14);
        doc.setTextColor(44, 62, 80);
        doc.text('Daily Nutrition Targets', 20, 110);
        
        doc.setFontSize(12);
        doc.setTextColor(74, 85, 104);
        doc.text(`Calories: ${results.calories} kcal`, 30, 120);
        doc.text(`Protein: ${results.protein}g (${Math.round(results.protein/leanMass * 10) / 10}g/lb LBM)`, 30, 127);
        doc.text(`Carbs: ${results.carbs}g`, 30, 134);
        doc.text(`Fat: ${results.fat}g`, 30, 141);

        // Add Transform Training services
        doc.setFontSize(14);
        doc.setTextColor(44, 62, 80);
        doc.text('Next Steps with Transform Training', 20, 160);
        
        doc.setFontSize(12);
        doc.setTextColor(74, 85, 104);
        doc.text('Our services include:', 20, 170);
        const services = [
            'Personalized nutrition coaching',
            'Custom meal planning',
            'Progress tracking and adjustments',
            '1-on-1 training programs',
            'Ongoing support and accountability'
        ];
        services.forEach((service, index) => {
            doc.text(`â€¢ ${service}`, 25, 180 + (index * 7));
        });

        // Add contact information
        doc.setFontSize(12);
        doc.setTextColor(44, 62, 80);
        doc.text('Contact us to get started:', 20, 220);
        doc.setTextColor(74, 85, 104);
        doc.text('Email: info@transformtraining.com', 25, 230);
        doc.text('Phone: (555) 123-4567', 25, 237);
        doc.text('Website: www.transformtraining.com', 25, 244);

        // Save the PDF
        doc.save('transform-training-nutrition-plan.pdf');
    };

    // Add email submission function
    const handleEmailSubmit = async (e) => {
        e.preventDefault();
        setIsSubmitting(true);
        setEmailStatus('');

        try {
            // Subscribe to Squarespace Email Campaigns
            const response = await fetch('/api/email-campaigns/submit', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({
                    'listId': 'YOUR_LIST_ID', // Get this from Squarespace
                    'email': email,
                    'firstName': '',  // Optional
                    'lastName': '',   // Optional
                    'source': 'Macro Calculator'
                })
            });

            if (response.ok) {
                setEmailStatus('success');
                setEmail('');
                // Generate and send PDF automatically
                generatePDF();
            } else {
                throw new Error('Failed to subscribe');
            }
        } catch (error) {
            setEmailStatus('error');
        } finally {
            setIsSubmitting(false);
        }
    };

    // Component render
    return (
        <div className="calculator-card">
            <form onSubmit={calculate}>
                {/* Physical Profile Section */}
                <div style={accordionStyles.section}>
                    <div 
                        style={accordionStyles.header}
                        onClick={() => setOpenSections({...openSections, profile: !openSections.profile})}
                    >
                        <h3 style={accordionStyles.title}>Physical Profile</h3>
                        <span>{openSections.profile ? 'âˆ’' : '+'}</span>
                    </div>
                    {openSections.profile && (
                        <div style={accordionStyles.content}>
                            <div style={{
                                display: 'grid',
                                gridTemplateColumns: '40% 60%',
                                gap: '20px',
                                alignItems: 'start'
                            }}>
                                {/* Left Column - Basic Measurements */}
                                <div>
                                    <div className="form-group" style={{marginBottom: '15px'}}>
                                        <label>Gender</label>
                                        <div className="gender-select">
                                            <button
                                                type="button"
                                                className={`gender-option ${data.gender === 'male' ? 'selected' : ''}`}
                                                onClick={() => setData({...data, gender: 'male'})}
                                            >
                                                Male
                                            </button>
                                            <button
                                                type="button"
                                                className={`gender-option ${data.gender === 'female' ? 'selected' : ''}`}
                                                onClick={() => setData({...data, gender: 'female'})}
                                            >
                                                Female
                                            </button>
                                        </div>
                                    </div>

                                    <div className="form-group">
                                        <label>Weight (lbs)</label>
                                        <input 
                                            type="number"
                                            className={`input-field ${validationErrors.weight ? 'error' : ''}`}
                                            value={data.weight}
                                            onChange={e => {
                                                const value = e.target.value;
                                                const error = validateField('weight', value);
                                                setValidationErrors({...validationErrors, weight: error});
                                                setData({...data, weight: value});
                                            }}
                                        />
                                        {validationErrors.weight && (
                                            <div className="error-message">{validationErrors.weight}</div>
                                        )}
                                    </div>

                                    <div className="form-group">
                                        <label>Height (inches)</label>
                                        <input 
                                            type="number"
                                            className={`input-field ${validationErrors.height ? 'error' : ''}`}
                                            value={data.height}
                                            onChange={e => {
                                                const value = e.target.value;
                                                const error = validateField('height', value);
                                                setValidationErrors({...validationErrors, height: error});
                                                setData({...data, height: value});
                                            }}
                                        />
                                        {validationErrors.height && (
                                            <div className="error-message">{validationErrors.height}</div>
                                        )}
                                    </div>
                                </div>

                                {/* Right Column - Body Composition */}
                                <div className="body-comp-inputs">
                                    <div className="form-group">
                                        <label>Body Fat Estimation Method</label>
                                        <select 
                                            className="input-field"
                                            value={data.bodyFatMethod || 'dexa'}
                                            onChange={e => setData({...data, bodyFatMethod: e.target.value})}
                                        >
                                            <option value="dexa">DEXA / Caliper / BodPod</option>
                                            <option value="navy">Navy Method</option>
                                        </select>
                                    </div>

                                    {/* Body fat input methods */}
                                    {data.bodyFatMethod === 'dexa' ? (
                                        <div className="form-group">
                                            <label>Body Fat Percentage</label>
                                            <input 
                                                type="number"
                                                className="input-field"
                                                value={data.bodyFat}
                                                onChange={e => setData({...data, bodyFat: e.target.value})}
                                                placeholder="Enter body fat %"
                                            />
                                            {data.bodyFat && (
                                                <div className="estimated-bf" style={{marginTop: '10px'}}>
                                                    Current Body Fat: {data.bodyFat}%
                                                    <div className="bf-range" style={{fontSize: '12px', color: '#666', marginTop: '4px'}}>
                                                        {data.gender === 'male' ? (
                                                            `Optimal range for men: 12-18%`
                                                        ) : (
                                                            `Optimal range for women: 18-24%`
                                                        )}
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    ) : (
                                        <div>
                                            <div className="navy-measurements">
                                                <div className="measurement-input">
                                                    <label>
                                                        Waist
                                                        <span 
                                                            className="measurement-tooltip" 
                                                            data-tip={data.gender === 'male' ? 
                                                                "Measure at belly button level" : 
                                                                "Measure at narrowest point"}
                                                        />
                                                    </label>
                                                    <input 
                                                        type="number"
                                                        className="input-field"
                                                        value={data.waist || ''}
                                                        onChange={e => {
                                                            const value = e.target.value;
                                                            const updatedData = { ...data, waist: value };
                                                            updatedData.bodyFat = calculateNavyBodyFat(updatedData);
                                                            setData(updatedData);
                                                        }}
                                                        placeholder="inches"
                                                    />
                                                </div>
                                                <div className="measurement-input">
                                                    <label>
                                                        Neck
                                                        <span 
                                                            className="measurement-tooltip" 
                                                            data-tip="Measure below Adam's apple"
                                                        />
                                                    </label>
                                                    <input 
                                                        type="number"
                                                        className="input-field"
                                                        value={data.neck || ''}
                                                        onChange={e => {
                                                            const value = e.target.value;
                                                            const updatedData = { ...data, neck: value };
                                                            updatedData.bodyFat = calculateNavyBodyFat(updatedData);
                                                            setData(updatedData);
                                                        }}
                                                        placeholder="inches"
                                                    />
                                                </div>
                                                {data.gender === 'female' && (
                                                    <div className="measurement-input">
                                                        <label>
                                                            Hip
                                                            <span 
                                                                className="measurement-tooltip" 
                                                                data-tip="Measure at widest point"
                                                            />
                                                        </label>
                                                        <input 
                                                            type="number"
                                                            className="input-field"
                                                            value={data.hip || ''}
                                                            onChange={e => {
                                                                const value = e.target.value;
                                                                const updatedData = { ...data, hip: value };
                                                                updatedData.bodyFat = calculateNavyBodyFat(updatedData);
                                                                setData(updatedData);
                                                            }}
                                                            placeholder="inches"
                                                        />
                                                    </div>
                                                )}
                                            </div>
                                            {data.bodyFat && (
                                                <div className="estimated-bf">
                                                    Estimated Body Fat: {data.bodyFat}%
                                                    <div className="bf-range" style={{fontSize: '12px', color: '#666', marginTop: '4px'}}>
                                                        {data.gender === 'male' ? (
                                                            `Optimal range for men: 12-18%`
                                                        ) : (
                                                            `Optimal range for women: 18-24%`
                                                        )}
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}
                </div>

                {/* Activity & Goals Section */}
                <div style={accordionStyles.section}>
                    <div 
                        style={accordionStyles.header}
                        onClick={() => setOpenSections({...openSections, activity: !openSections.activity})}
                    >
                        <h3 style={accordionStyles.title}>Activity & Goals</h3>
                        <span>{openSections.activity ? 'âˆ’' : '+'}</span>
                    </div>
                    {openSections.activity && (
                        <div style={accordionStyles.content}>
                            {/* Activity level and goals selection */}
                            <div className="form-group">
                                <label>Daily Activity Level (excluding workouts)</label>
                                <div style={{ display: 'flex', gap: '20px' }}>
                                    <div className="activity-group" style={{ flex: '0 0 50%' }}>
                                        <button 
                                            type="button"
                                            className={`activity-button ${data.activity === 'sedentary' ? 'selected' : ''}`}
                                            onClick={() => setData({...data, activity: 'sedentary'})}
                                            onMouseEnter={() => setHoverDescription(`
                                                Desk job, little to no exercise, and no strenuous hobbies. 
                                                â€¢ Sitting most of the day
                                                â€¢ Little walking
                                                â€¢ No physically demanding tasks
                                                Multiplier: 1.2
                                            `)}
                                        >
                                            Sedentary
                                        </button>
                                        <button 
                                            type="button"
                                            className={`activity-button ${data.activity === 'light' ? 'selected' : ''}`}
                                            onClick={() => setData({...data, activity: 'light'})}
                                            onMouseEnter={() => setHoverDescription(`
                                                Office job with some walking during day, or standing job with little movement.
                                                â€¢ Regular daily walking
                                                â€¢ Standing or moving 2-3 hours per day
                                                â€¢ Light housework
                                                Multiplier: 1.375
                                            `)}
                                        >
                                            Lightly Active
                                        </button>
                                        <button 
                                            type="button"
                                            className={`activity-button ${data.activity === 'moderate' ? 'selected' : ''}`}
                                            onClick={() => setData({...data, activity: 'moderate'})}
                                            onMouseEnter={() => setHoverDescription(`
                                                Job with physical activity or daily walking/standing requirements.
                                                â€¢ Retail worker
                                                â€¢ Teacher
                                                â€¢ Construction (light work)
                                                â€¢ Most stay-at-home parents
                                                Multiplier: 1.55
                                            `)}
                                        >
                                            Moderately Active
                                        </button>
                                        <button 
                                            type="button"
                                            className={`activity-button ${data.activity === 'very' ? 'selected' : ''}`}
                                            onClick={() => setData({...data, activity: 'very'})}
                                            onMouseEnter={() => setHoverDescription(`
                                                Physically demanding job or highly active lifestyle.
                                                â€¢ Construction (heavy work)
                                                â€¢ Farmer
                                                â€¢ Professional athlete
                                                â€¢ Full-time athlete
                                                Multiplier: 1.725
                                            `)}
                                        >
                                            Very Active
                                        </button>
                                    </div>
                                    <div className="activity-description-box">
                                        {hoverDescription || 'Hover over an activity level to see its description'}
                                    </div>
                                </div>
                                <div style={{marginTop: '10px', fontSize: '14px', color: '#666'}}>
                                    Note: Do not include workout activity here. Select based on your regular daily activity level only.
                                </div>
                            </div>

                            <div className="form-group">
                                <label>Goal</label>
                                <select 
                                    className="input-field"
                                    value={data.goal}
                                    onChange={e => setData({...data, goal: e.target.value})}
                                >
                                    <option value="">Select Goal</option>
                                    <option value="lose">Lose Body Fat</option>
                                    <option value="maintain">Maintain Body Composition</option>
                                    <option value="gain">Build Lean Muscle</option>
                                </select>
                            </div>

                            {data.bodyFatMethod === 'navy' && (
                                <div style={{fontSize: '12px', color: '#666', marginTop: '4px', marginBottom: '10px'}}>
                                    Note: The Navy Method is accurate within Â±3-4% of underwater weighing when measurements are taken correctly.
                                </div>
                            )}
                        </div>
                    )}
                </div>

                <button 
                    type="submit" 
                    className={`button ${!isFormValid() ? 'button-disabled' : ''}`}
                    disabled={!isFormValid() || isCalculating}
                >
                    {isCalculating ? (
                        <span className="loading-spinner">Calculating...</span>
                    ) : (
                        !isFormValid() ? 'Please Fill All Required Fields' : 'Calculate Macros'
                    )}
                </button>
            </form>
            {/* Results Section */}
            {results && (
                <div>
                    <div className="results">
                        {/* Energy Breakdown Section */}
                        <div className="results-section">
                            <h4 style={{margin: '0 0 10px 0'}}>Energy Breakdown</h4>
                            <div className="macro-results">
                                <div className="macro-result">
                                    <span className="tooltip" title="Basal Metabolic Rate: The calories your body burns at complete rest">
                                        BMR
                                    </span>
                                    <span>{(results.energyData && results.energyData.bmr) || 0} cal</span>
                                </div>
                                <div className="macro-result">
                                    <span className="tooltip" title="Additional calories burned from daily activities (excluding workouts)">
                                        Activity
                                    </span>
                                    <span>+{(results.energyData && results.energyData.activityCalories) || 0} cal</span>
                                </div>
                                <div className="macro-result">
                                    <span className="tooltip" title="Total Daily Energy Expenditure: Your total daily calorie burn">
                                        TDEE
                                    </span>
                                    <span>{(results.energyData && results.energyData.tdee) || 0} cal</span>
                                </div>
                                <div className="macro-result" style={{
                                    color: (!results.energyData || !results.energyData.calorieAdjustment) ? '#2c3e50' :
                                           results.energyData.calorieAdjustment < 0 ? '#e53e3e' : '#2f855a'
                                }}>
                                    <span className="tooltip" title="Calorie adjustment based on your selected goal">
                                        Adjustment
                                    </span>
                                    <span>{(results.energyData && results.energyData.calorieAdjustment > 0 ? '+' : '') + 
                                           ((results.energyData && results.energyData.calorieAdjustment) || 0)}%</span>
                                </div>
                                <div className="target-divider" />
                                <div className="macro-result" style={{fontWeight: 'bold', fontSize: '16px'}}>
                                    <span>Daily Calories</span>
                                    <span>{results.calories}</span>
                                </div>
                            </div>
                        </div>

                        {/* Macronutrient Section */}
                        <div className="results-section">
                            <div style={{
                                display: 'flex',
                                justifyContent: 'space-between',
                                alignItems: 'center',
                                marginBottom: '10px'
                            }}>
                                <h4 style={{margin: 0}}>Macronutrient Targets</h4>
                                <button 
                                    className={`edit-icon ${showCustomize ? 'active' : ''}`}
                                    onClick={() => setShowCustomize(!showCustomize)}
                                    title="Customize macros"
                                >
                                    {showCustomize ? 'âœ“' : 'âœŽ'}
                                </button>
                            </div>
                            <div className="macro-results">
                                <div className="macro-result">
                                    <span>
                                        Protein ({Math.round(results.protein/leanMass * 10) / 10}g/lb LBM)
                                    </span>
                                    <span className="macro-value">
                                        {showCustomize ? (
                                            <input 
                                                type="number"
                                                className="inline-edit"
                                                value={proteinMultiplier}
                                                onChange={(e) => {
                                                    const num = parseFloat(e.target.value);
                                                    if (!isNaN(num) && num >= 0) {
                                                        setProteinMultiplier(num);
                                                    }
                                                }}
                                                min="0"
                                                step="0.1"
                                            />
                                        ) : (
                                            results.protein
                                        )}
                                        g
                                    </span>
                                </div>
                                <div className="macro-result">
                                    <span>Carbs</span>
                                    <span className="macro-value">
                                        {showCustomize ? (
                                            <input 
                                                type="number"
                                                className="inline-edit"
                                                value={customCarbs}
                                                onChange={(e) => {
                                                    const value = e.target.value;
                                                    if (value === '') {
                                                        setCustomCarbs('');  // Allow empty value while typing
                                                    } else {
                                                        const num = parseInt(value);
                                                        if (!isNaN(num) && num >= 0) {
                                                            setCustomCarbs(num);
                                                        }
                                                    }
                                                }}
                                                min="0"
                                            />
                                        ) : (
                                            results.carbs
                                        )}
                                        g
                                    </span>
                                </div>
                                <div className="macro-result">
                                    <span>Fat</span>
                                    <span>{results.fat}g</span>
                                </div>
                            </div>
                            
                            {showCustomize && (
                                <div className="customize-panel">
                                    <div className="slider-container">
                                        <div style={{
                                            display: 'flex',
                                            justifyContent: 'space-between',
                                            alignItems: 'center',
                                            marginBottom: '10px'
                                        }}>
                                            <label>Goal Adjustment</label>
                                            <span style={{
                                                color: Math.abs(calorieAdjustment) <= 10 ? '#2f855a' :
                                                       Math.abs(calorieAdjustment) <= 20 ? '#ecc94b' : '#e53e3e'
                                            }}>
                                                {calorieAdjustment > 0 ? '+' : ''}{calorieAdjustment}%
                                            </span>
                                        </div>
                                        <input
                                            type="range"
                                            min="-30"
                                            max="30"
                                            step="5"
                                            value={calorieAdjustment}
                                            onChange={(e) => setCalorieAdjustment(parseInt(e.target.value))}
                                            className={`slider ${
                                                Math.abs(calorieAdjustment) <= 10 ? 'green' :
                                                Math.abs(calorieAdjustment) <= 20 ? 'yellow' : 'red'
                                            }`}
                                        />
                                        <div className="slider-labels">
                                            <span>-30%</span>
                                            <span>0%</span>
                                            <span>+30%</span>
                                        </div>
                                        {Math.abs(calorieAdjustment) >= 30 && (
                                            <div className="warning-text">
                                                {calorieAdjustment < 0 
                                                    ? "Warning: This is a very aggressive deficit"
                                                    : "Warning: This is a very aggressive surplus"}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                    <div className="methodology-section">
                        <h4 onClick={() => setShowMethodology(!showMethodology)}>
                            Calculation Methodology {showMethodology ? 'âˆ’' : '+'}
                        </h4>
                        {showMethodology && (
                            <div className="methodology-content">
                                <div className="methodology-subsection">
                                    <h5>Basal Metabolic Rate (BMR)</h5>
                                    <p>BMR is calculated using the Katch-McArdle formula, which is more accurate than other methods as it accounts for lean body mass:</p>
                                    <div className="formula">BMR = 370 + (21.6 Ã— Lean Body Mass in kg)</div>
                                </div>

                                <div className="methodology-subsection">
                                    <h5>Total Daily Energy Expenditure (TDEE)</h5>
                                    <p>TDEE is calculated by multiplying BMR by an activity multiplier:</p>
                                    <ul>
                                        <li>Sedentary: Ã— 1.2</li>
                                        <li>Lightly Active: Ã— 1.375</li>
                                        <li>Moderately Active: Ã— 1.55</li>
                                        <li>Very Active: Ã— 1.725</li>
                                    </ul>
                                </div>

                                <div className="methodology-subsection">
                                    <h5>Body Fat Estimation</h5>
                                    <p>The Navy Method uses the following formulas:</p>
                                    <p><strong>Male:</strong></p>
                                    <div className="formula">%BF = 86.010Ã—log10(waist-neck) - 70.041Ã—log10(height) + 36.76</div>
                                    <p><strong>Female:</strong></p>
                                    <div className="formula">%BF = 163.205Ã—log10(waist+hip-neck) - 97.684Ã—log10(height) - 78.387</div>
                                </div>

                                <div className="methodology-subsection">
                                    <h5>Macronutrient Calculations</h5>
                                    <p>Default macronutrient targets are set based on these principles:</p>
                                    <ul>
                                        <li>Protein: 1g per pound of lean body mass</li>
                                        <li>Fat: 25% of total calories (minimum healthy threshold)</li>
                                        <li>Carbs: Remaining calories after protein and fat</li>
                                    </ul>
                                    <p>These can be customized based on individual preferences and goals.</p>
                                </div>
                            </div>
                        )}
                    </div>
                    <div className="summary-section">
                        <div className="summary-header">
                            <h4 style={{margin: 0}}>Your Personalized Nutrition Plan</h4>
                            <button 
                                className="print-button"
                                onClick={generatePDF}
                            >
                                Download PDF ðŸ“„
                            </button>
                        </div>
                        <div className="summary-content">
                            <p>Based on your profile:</p>
                            <ul>
                                <li>Height: {data.height} inches</li>
                                <li>Weight: {data.weight} lbs</li>
                                <li>Body Fat: {data.bodyFat}%</li>
                                <li>Lean Body Mass: {Math.round(leanMass)} lbs</li>
                                <li>Activity Level: {data.activity}</li>
                                <li>Goal: {data.goal === 'lose' ? 'Lose Body Fat' :
                                          data.goal === 'maintain' ? 'Maintain Body Composition' :
                                          data.goal === 'gain' ? 'Build Lean Muscle' : ''}</li>
                            </ul>
                            
                            <div className="summary-stats">
                                <h5>Your Daily Targets:</h5>
                                <p>Calories: {results.calories} kcal</p>
                                <p>Protein: {results.protein}g ({Math.round(results.protein/leanMass * 10) / 10}g/lb LBM)</p>
                                <p>Carbs: {results.carbs}g</p>
                                <p>Fat: {results.fat}g</p>
                            </div>

                            <div className="transform-services">
                                <h5>Transform Your Results with Professional Guidance</h5>
                                <p>While these calculations provide a scientific starting point, achieving your fitness goals requires proper implementation and adjustments. Transform Training offers:</p>
                                <ul>
                                    <li>Personalized nutrition coaching</li>
                                    <li>Custom meal planning</li>
                                    <li>Progress tracking and adjustments</li>
                                    <li>1-on-1 training programs</li>
                                    <li>Ongoing support and accountability</li>
                                </ul>
                                <p>Ready to transform your body and health? Contact us to schedule a consultation:</p>
                                <p style={{marginTop: '10px'}}>
                                    <strong>Email:</strong> info@transformtraining.com<br/>
                                    <strong>Phone:</strong> (555) 123-4567<br/>
                                    <strong>Website:</strong> www.transformtraining.com
                                </p>
                            </div>

                            {/* Email form */}
                            <div className="email-form">
                                <h5>Get Your Results by Email</h5>
                                <p>We'll send you your personalized plan and keep you updated with nutrition tips and exclusive offers.</p>
                                <form onSubmit={handleEmailSubmit} className="email-input-group">
                                    <input
                                        type="email"
                                        className="email-input"
                                        value={email}
                                        onChange={(e) => setEmail(e.target.value)}
                                        placeholder="Enter your email"
                                        required
                                    />
                                    <button 
                                        type="submit" 
                                        className="email-button"
                                        disabled={isSubmitting}
                                    >
                                        {isSubmitting ? 'Sending...' : 'Send Results'}
                                    </button>
                                </form>
                                {emailStatus === 'success' && (
                                    <div className="email-status success">
                                        Great! Check your email for your personalized plan.
                                    </div>
                                )}
                                {emailStatus === 'error' && (
                                    <div className="email-status error">
                                        Sorry, there was an error. Please try again.
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            )}
        </div>
    );
};

// Render the calculator
ReactDOM.render(<Calculator />, document.getElementById('macro-calculator'));
</script>
